#!/bin/bash

date | tee -a ~/BitcoinPriceHistory

curl -s https://www.bitcoinprice.com/ | grep -A 5 '"name": "BTC",' | grep '"price"' | tr -d '[:alpha:]' | tr -d '": ' | tee -a ~/BitcoinPriceHistory

FILE=~/BitcoinPriceHistory
last=$(cat ~/BitcoinPriceHistory | grep -v ":" | tail -n 2 | head -n 1)
current=$(cat ~/BitcoinPriceHistory | grep -v ":" | tail -n 1)
result=$(echo "$current - $last" | bc -l | cut -d '.' -f 1)

if [ $(date +%u) -gt 1 ] && [ $(date +%H) = 8 ];then
	if test $result -gt 0; then notify-send -u normal -t 5000 "Price Alert" "The price of Bitcoin has changed +$result dollars since last night." 
	else notify-send -u normal -t 5000 "Price Alert" "The price of Bitcoin has changed $result dollars since last night."
	fi
fi

if [ $(date +%u) = 1 ] && [ $(date +%H) = 8 ];then
	if test $result -gt 0; then notify-send -u normal -t 5000 "Price Alert" "The price of Bitcoin has changed +$result dollars since Friday." 
	else notify-send -u normal -t 5000 "Price Alert" "The price of Bitcoin has changed $result dollars since Friday."
	fi
fi

if [ $(date +%H) -gt 8 ];then
	if test $result -gt 0; then notify-send -u normal -t 5000 "Price Alert" "The price of Bitcoin has changed +$result dollars in the last hour." 
	else notify-send -u normal -t 5000 "Price Alert" "The price of Bitcoin has changed $result dollars in the last hour."
	fi
fi

check=$(cat ~/BitcoinPriceHistory | wc -l)

if test $check -gt 48;then
	tail -n 48 ~/BitcoinPriceHistory > ~/somerandomfilename.abc ; cat ~/somerandomfilename.abc > ~/BitcoinPriceHistory && rm ~/somerandomfilename.abc 2>/dev/null
fi

exit
